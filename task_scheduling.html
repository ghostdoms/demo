<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>任务调度-MeshExpert</title>
    <link rel="stylesheet" href="css/style.css">
    <link rel="stylesheet" href="css/task_scheduling.css">
</head>

<body>
    <div class="wrap">
        <header class="clearfix">
            <h3><a href="index.html"><img src="images/logo.png" alt="">MeshExpert</a></h3>
            <nav>
                <li class="on"><a href="monitoring_statistics.html">数据归集</a></li>
                <li><a href="http://192.168.2.40">数据分析</a></li>
                <li><a href="machine.html">资源管理</a></li>
                <li><a href="permission.html">权限管理</a></li>
            </nav>
            <div class="userbox clearfix">
                <span>
                    <b class="use-b">
                        用户名：<em class="user">---</em>
                        <div class="index-option">
                            <ul>
                                <li><a href="changepsd.html">个人信息</a></li>
                                <li><a class="logout">退出</a></li>
                            </ul>
                        </div>
                    </b>
                </span>
            </div>
        </header>
        <nav class="one-title">
            <ul class="clearfix">
                <li class="no-down"><a href="monitoring_statistics.html">监控统计</a></li>
                <li>
                    <a href="data_source.html">数据管理</a>
                    <div class="taskbox">
                        <ul>
                            <li><a href="data_source.html">数据源管理</a></li>
                            <li><a href="table.html">数据仓库管理</a></li>
                            <li><a href="create_hive.html">新建数据表</a></li>
                        </ul>
                    </div>
                </li>
                <li class="on">
                    <a href="task_manager.html">任务配置</a>
                    <div class="taskbox">
                        <ul>
                            <li><a href="task_manager.html">任务管理</a></li>
                            <li><a href="task_new.html">新建任务</a></li>
                        </ul>
                    </div>
                </li>
            </ul>
        </nav>
        <nav class="two-title">
            <ul class="clearfix">
                <li class="on"><a href="javascript:;">任务调度</a></li>
            </ul>
        </nav>
        <section class="content">
            <span class="conf">设置任务调度及运行时间</span>
            <div class="date_def">
                <label for="" class="clearfix">
                    <span>开始日期：</span>
                    <input type="text" placeholder="默认建立任务时间" id="date_sta">
                    <b id="date_ri_f"></b>
                </label>
                <label for="" class="clearfix">
                    <span>停止日期：</span>
                    <input type="text" placeholder="默认建立任务时间" id="date_sto">
                    <b id="date_ri_s"></b>
                </label>
            </div>
            <div class="mod every0">
                <div class="week">
                    <input type="radio" name="datetype" id="every_w" class="choo" checked="checked" value="每周">
                    <label for="every_w"></label>
                    <span>每周</span>
                    <ul class="clearfix">
                        <li>
                            <span></span>周一</li>
                        <li>
                            <span></span>周二</li>
                        <li>
                            <span></span>周三</li>
                        <li>
                            <span></span>周四</li>
                        <li>
                            <span></span>周五</li>
                        <li>
                            <span></span>周六</li>
                        <li>
                            <span></span>周日</li>
                    </ul>
                </div>
                <div class="month">
                    <input type="radio" name="datetype" id="every_m" class="choo" value="每月">
                    <label for="every_m"></label>
                    <span>每月</span>
                    <ul class="clearfix">
                        <li><span></span>01
                        </li>
                        <li><span></span>02
                        </li>
                        <li><span></span>03
                        </li>
                        <li><span></span>04
                        </li>
                        <li><span></span>05
                        </li>
                        <li><span></span>06
                        </li>
                        <li><span></span>07
                        </li>
                        <li><span></span>08
                        </li>
                        <li><span></span>09
                        </li>
                        <li><span></span>10
                        </li>
                        <li><span></span>11
                        </li>
                        <li><span></span>12
                        </li>
                        <li><span></span>13
                        </li>
                        <li><span></span>14
                        </li>
                        <li><span></span>15
                        </li>
                        <li><span></span>16
                        </li>
                        <li><span></span>17
                        </li>
                        <li><span></span>18
                        </li>
                        <li><span></span>19
                        </li>
                        <li><span></span>20
                        </li>
                        <li><span></span>21
                        </li>
                        <li><span></span>22
                        </li>
                        <li><span></span>23
                        </li>
                        <li><span></span>24
                        </li>
                        <li><span></span>25
                        </li>
                        <li><span></span>26
                        </li>
                        <li><span></span>27
                        </li>
                        <li><span></span>28
                        </li>
                        <li><span></span>29
                        </li>
                        <li><span></span>30
                        </li>
                        <li><span></span>31
                        </li>
                    </ul>
                </div>
                <div class="starttime">
                    <label for="">
                        <span>开始时间：</span>
                        <input type="text" placeholder="01:00">
                        <span class="add">继续添加新的运行时间</span>
                    </label>
                </div>
            </div>
            <div class="endbox">
                <a class="end">完 成</a>
            </div>
        </section>
        <div class="mark
">
            <div class="iscancel">
                <div>
                    <span class="true trues">去新建任务</span>
                    <span class="true cancels">继续新建表</span>
                    <span class="cancel cancels">取消</span>
                </div>
                <div class="close">×</div>
            </div>
        </div>
        <script type="text/javascript" src="js/lib/jquery.js"></script>
        <script type="text/javascript" src="js/lib/laydate.dev.js"></script>
        <script type="text/javascript" src="js/config.js"></script>
        <script type="text/javascript" src="js/common.js"></script>
        <script type="text/javascript">
        document.getElementById('date_ri_f').onclick = function() {
            laydate({
                elem: '#date_sta'
            });
        };
        document.getElementById('date_ri_s').onclick = function() {
            laydate({
                elem: '#date_sto'
            });
        };
        // var arr = [];
        // arr['every_w'] = [];
        // arr['every_m'] = [];
        // $('.content').delegate('ul', 'click', function(e) {
        //     e.stopPropagation();
        //     var tarEle = e.target.tagName;
        //     var isCheVal = $(this).prev().text();
        //     var cheEle = $('input[type=radio]:checked').val();
        //     //console.log($(e.target).parents('ul').siblings().eq(0).attr('id'));
        //     var inpId = $(e.target).parents('ul').siblings().eq(0).attr('id');
        //     console.log(inpId);
        //     // var obj[inpId]=[];
        //     if (isCheVal === cheEle && tarEle === 'SPAN') {
        //         $(e.target).toggleClass('on');
        //         // if ($.inArray($(e.target).parent().index() + 1, arr) > -1) {
        //         //     remarr(arr, $(e.target).parent().index() + 1);
        //         // } else {
        //         //     arr.push($(e.target).parent().index() + 1);
        //         // };
        //         console.log($(e.target).parent().index() + 1);
        //         if ($.inArray($(e.target).parent().index() + 1, arr[inpId]) > -1) {
        //             remarr(arr[inpId], $(e.target).parent().index() + 1);
        //         } else {
        //             arr[inpId].push($(e.target).parent().index() + 1);
        //         };
        //         console.log(arr);
        //     };
        // });


        $('.content').delegate('ul', 'click', function(e) {
            e.stopPropagation();
            var tarEle = e.target.tagName;
            var isCheVal = $(this).prev().text();
            var cheEle = $('input[type=radio]:checked').val();
            var inpId = $(e.target).parents('ul').siblings().eq(0).attr('id');
            console.log(inpId);
            if (isCheVal === cheEle && tarEle === 'SPAN') {
                $(e.target).toggleClass('on');
            };
        });




        $('.choo').next().on('click', function() {
            if ($(this).attr('for') == 'every_w') {
                $('.month').find('span').removeClass('on');
                //  arr = [];
            } else {
                $('.week').find('span').removeClass('on');
                //  arr = [];
            }
        });


        var obj={};
        obj[`every0`]=[];
        $('.end').on('click', function() {
            var len=$('.mod').length;
            var arr = [];
            for(var i=0;i<len;i++){
                var ele=$(`.every${i}`).find('span.on');
                var le=ele.length;
                for(var z=0;z<le;z++){
                    arr.push(ele.eq(z).parent().index()+1);
                };
                obj[`every${i}`]['week']=arr;
                obj[`every${i}`]['time']='1:00';
            }
            console.log(obj)

            $('.mark').show();
            if (window.scrollY > 0) {
                $('.mark').css('top', 0);
            } else {
                $('.mark').css('top', $('header').height() + $('.one-title').height() + 'px');
            };
            $('.iscancel').on('click', function(e) {
                e.stopPropagation();
            });
            $('.mark').not('.iscancel').on('click', function() {
                $('.mark').hide();
            });
        });

        function remarr(arr, ele) {
            var len = arr.length;
            for (var i = 0; i < len; i++) {
                if (arr[i] == ele) {
                    arr.splice(i, 1)
                }
            };
            return arr;
        };
        var init = 0;
        $('.content').delegate('.add', 'click', function() {
                init++;
                var addbox = `<div class="mod every${init}">
                <div class="week">
                    <input type="radio" name="datetype${init}" id="every_w${init}" class="choo" checked="checked" value="每周">
                    <label for="every_w${init}"></label>
                    <span>每周</span>
                    <ul class="clearfix">
                        <li>
                            <span></span>周一</li>
                        <li>
                            <span></span>周二</li>
                        <li>
                            <span></span>周三</li>
                        <li>
                            <span></span>周四</li>
                        <li>
                            <span></span>周五</li>
                        <li>
                            <span></span>周六</li>
                        <li>
                            <span></span>周日</li>
                    </ul>
                </div>
                <div class="month">
                    <input type="radio" name="datetype${init}" id="every_m${init}" class="choo" value="每月">
                    <label for="every_m${init}"></label>
                    <span>每月</span>
                    <ul class="clearfix">
                        <li><span></span>01
                        </li>
                        <li><span></span>02
                        </li>
                        <li><span></span>03
                        </li>
                        <li><span></span>04
                        </li>
                        <li><span></span>05
                        </li>
                        <li><span></span>06
                        </li>
                        <li><span></span>07
                        </li>
                        <li><span></span>08
                        </li>
                        <li><span></span>09
                        </li>
                        <li><span></span>10
                        </li>
                        <li><span></span>11
                        </li>
                        <li><span></span>12
                        </li>
                        <li><span></span>13
                        </li>
                        <li><span></span>14
                        </li>
                        <li><span></span>15
                        </li>
                        <li><span></span>16
                        </li>
                        <li><span></span>17
                        </li>
                        <li><span></span>18
                        </li>
                        <li><span></span>19
                        </li>
                        <li><span></span>20
                        </li>
                        <li><span></span>21
                        </li>
                        <li><span></span>22
                        </li>
                        <li><span></span>23
                        </li>
                        <li><span></span>24
                        </li>
                        <li><span></span>25
                        </li>
                        <li><span></span>26
                        </li>
                        <li><span></span>27
                        </li>
                        <li><span></span>28
                        </li>
                        <li><span></span>29
                        </li>
                        <li><span></span>30
                        </li>
                        <li><span></span>31
                        </li>
                    </ul>
                </div>
                <div class="starttime">
                    <label for="">
                        <span>开始时间：</span>
                        <input type="text" placeholder="01:00">
                        <span class="add">继续添加新的运行时间</span>
                    </label>
                </div>
            </div>`;
                $('.endbox').before(addbox);
                obj[`every${init}`]=[];
               // arr[`every_w${init}`] = [];
               // arr[`every_m${init}`] = [];
            })
            // console.log(remarr([1,2,3,4],4));
        </script>
</body>

</html>
